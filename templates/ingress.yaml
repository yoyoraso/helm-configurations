{{- if ((.Values.ingress)) -}}
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
  labels:
    app: {{.Values.name}}
    env: {{.Release.Namespace}}
  name: {{.Values.name}}
  namespace: {{.Release.Namespace}}
spec:
  rules:
  - host: argo-rollouts.io
    http:
      paths:
      - path: /blue-green/active
        pathType: ImplementationSpecific
        backend:
          service:
            name: {{ $.Values.name }}-active
            port:
              number: {{ (($.Values.service).port) | default 80 }}
      - path: /blue-green/preview
        pathType: ImplementationSpecific
        backend:
          service:
            name: {{ $.Values.name }}-preview
            port:
              number: {{ (($.Values.service).port) | default 80 }}                    
    - path: /canary
      pathType: ImplementationSpecific
      backend:
        service:
          name: {{ .Values.name }}
          port:
            number: {{ ((.Values.service).port) | default 80 }}
    {{- end }}
